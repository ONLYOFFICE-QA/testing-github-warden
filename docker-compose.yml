version: '2'
services:
  warden:
    build:
      context: .
      dockerfile: dockerfiles/warden/Dockerfile
    ports:
      - "3000:3000"
    volumes:
      - ./tmp/redis/:/testing-github-warden/tmp/redis/
    depends_on:
      - redis
    restart: always
    environment:
      - GITHUB_WARDEN_SECRET_TOKEN=${GITHUB_WARDEN_SECRET_TOKEN}

  executioner:
    build:
      context: .
      dockerfile: dockerfiles/executioner/Dockerfile
    tty: true
    volumes:
      - ./tmp/redis/:/testing-github-warden/tmp/redis/
    command: ruby executioner.rb
    depends_on:
      - redis
    restart: always
    environment:
      - GITHUB_WARDEN_BUGZILLA_API_KEY=${GITHUB_WARDEN_BUGZILLA_API_KEY}
  redis:
    image: redis
    volumes:
      - ./tmp/redis:/data
    command: redis-server /data/redis.conf
    restart: always

volumes:
  redis_data:
